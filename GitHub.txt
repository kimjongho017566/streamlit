import streamlit as st
from datetime import datetime
from datetime import date
import pandas as pd

# ê²½ê³ ë©”ì‹œì§€ ì œê±° ë° ì•„ì´ì½˜ ë° í˜ì´ì§€ ì´ë¦„ ì„¤ì •
st.set_page_config(
    page_title="í™˜ì˜í•´ìš”",  # í˜ì´ì§€ ì´ë¦„ ì„¤ì •
    page_icon="ğŸŒŸ",  # ì›í•˜ëŠ” ì•„ì´ì½˜ ì´ëª¨ì§€ ë˜ëŠ” ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì •
    layout="wide"
)

######################## ìƒë‹¨ markdown style ì •ì˜ ############################

st.markdown("""
    <style>
    .main-title {
        font-size:50px !important;
        color: #000000; /* ê²€ì •ìƒ‰ */
        text-align: center;
        font-weight: bold;
        font-family: 'Arial', sans-serif;
    }
    </style>
    """, unsafe_allow_html=True)

st.markdown('<p class="main-title">ğŸŒŸê³µê°„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤ ğŸŒŸ</p>', unsafe_allow_html=True)
st.markdown("[ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ Manualë¡œ ì´ë™í•˜ì„¸ìš”](https://github.com/)")

##########################################################################

# ì´ˆê¸° ì„¸ì…˜ ìƒíƒœ ì„¤ì • (ìµœì´ˆ ì‹¤í–‰ ì‹œ í˜ì´ì§€ ìƒíƒœ ì €ì¥)
if "current_page" not in st.session_state:
    st.session_state.current_page = "ë°ì´í„° ê²€ìƒ‰"
    st.session_state.search_button = 0  # ë°ì´í„° ê²€ìƒ‰/ì„œì¹˜ ë²„íŠ¼ ì´ˆê¸°í™”

# ì‚¬ì´ë“œë°”ì— ë²„íŠ¼ì„ ì¶”ê°€í•˜ì—¬ í˜ì´ì§€ ì„ íƒ
st.sidebar.markdown("### í˜ì´ì§€ ì„ íƒ")
if st.sidebar.button("í™ˆ"):
    st.session_state.current_page = "í™ˆ"
    st.session_state.search_button = 0  # ë°ì´í„° ê²€ìƒ‰/ì„œì¹˜ ë²„íŠ¼ ì´ˆê¸°í™”
if st.sidebar.button("ë°ì´í„° ê²€ìƒ‰"):
    st.session_state.current_page = "ë°ì´í„° ê²€ìƒ‰"
    st.session_state.search_button = 0  # ë°ì´í„° ê²€ìƒ‰/ì„œì¹˜ ë²„íŠ¼ ì´ˆê¸°í™”
if st.sidebar.button("ê¸°íƒ€ ì •ë³´"):
    st.session_state.current_page = "ê¸°íƒ€ ì •ë³´"
    st.session_state.search_button = 0  # ë°ì´í„° ê²€ìƒ‰/ì„œì¹˜ ë²„íŠ¼ ì´ˆê¸°í™”

# í˜ì´ì§€ ì„ íƒì— ë”°ë¥¸ ì»¨í…ì¸  í‘œì‹œ
if st.session_state.current_page == "í™ˆ":
    st.write("í™ˆ í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!")
    st.write("ì—¬ê¸°ì—ì„œ ì „ì²´ ê°œìš”ì™€ ì•ˆë‚´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

elif st.session_state.current_page == "ë°ì´í„° ê²€ìƒ‰":
    # Form ìƒì„±
    with st.form("search_form"):
        col1, col2, col3, col4 = st.columns(4)

        with col1:
            combo_menu = st.selectbox('**ì•„ë˜ Option Menuë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”**', ['EBR', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='menu')

        with col2:
            combo_line = st.selectbox('**LINE ì„ íƒ**', ['15L', '16L'], key='line')

        with col3:
            combo_eqpid = st.selectbox('**EQP_ID ì„ íƒ**', ['ì„¤ë¹„1', 'ì„¤ë¹„2'], key='eqpid')

        with col4:
            selected_date = st.date_input("**ê³„ì¸¡ì™„ë£Œ ë‚ ì§œ**", value=date.today())

        _, _, col1 = st.columns([3, 0.4, 0.3])  # ì²« ë²ˆì§¸ ì—´ì„ ë” í¬ê²Œ í•´ì„œ ë²„íŠ¼ì´ ì˜¤ë¥¸ìª½ì— ë°°ì¹˜ë˜ë„ë¡ ì„¤ì •

        with col1:
            # Search ë²„íŠ¼ ì¶”ê°€ (ì˜¤ë¥¸ìª½ì— ë°°ì¹˜)
            search_button = st.form_submit_button("SEARCH")

    st.markdown("---")  # ìˆ˜í‰ì„ 

    # SEARCH ë²„íŠ¼ì´ ëˆŒë¦¬ë©´ ì„¸ì…˜ ìƒíƒœì— ì €ì¥í•˜ì—¬ ë¦¬ë Œë”ë§ ë°©ì§€
    if search_button:
        st.session_state.search_button = 1
        # ë°ì´í„° ì¡°íšŒí•˜ê¸°, ì¿¼ë¦¬ ì‘ì„± í›„ ì¡°íšŒ
        data_df = pd.DataFrame(
            {
                "EQP_ID": ["ì„¤ë¹„1", "ì„¤ë¹„2", "ì„¤ë¹„3", "ì„¤ë¹„4"],
                "ê³„ì¸¡ì™„ë£Œì‹œê°„": ["2024-10-7-12:00", "2024-10-8-12:00", "2024-10-9-12:00", "2024-10-10-12:00"],
                "ì •ë¦¬í•  DATA ì„ íƒ(1ê°œë§Œ)": [True, False, False, True],
                "SPEC ì„¤ì •": ["ì •ìƒ", "ì •ìƒ", "ì˜¤ë¥˜", "ì˜¤ë¥˜"]  # ì½¤ë³´ë°•ìŠ¤ í•­ëª©ìœ¼ë¡œ ì‚¬ìš©ë  ì—´
            }
        )

        # ì„ íƒëœ ë‚ ì§œë¥¼ ë°ì´í„°í”„ë ˆì„ì˜ 'ê³„ì¸¡ì™„ë£Œì‹œê°„'ê³¼ ë¹„êµí•˜ì—¬ í•„í„°ë§
        filtered_data = data_df[data_df['ê³„ì¸¡ì™„ë£Œì‹œê°„'].str.contains(str(selected_date))]

        # í•„í„°ë§ëœ ë°ì´í„°ë¥¼ ì„¸ì…˜ ìƒíƒœì— ì €ì¥
        st.session_state.filtered_data = filtered_data

    # ì„¸ì…˜ ìƒíƒœì— ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê·¸ë¦¬ê¸°
    if st.session_state.search_button == 1 and "filtered_data" in st.session_state and not st.session_state.filtered_data.empty:
        
        # Form ìƒì„±
        with st.form("DATA_FORM"):
            
            # í•„í„°ë§ëœ ë°ì´í„° ë° ì‹œê°„ í‘œì‹œ
            st.write(f"í•„í„°ë§ëœ ë°ì´í„° : {combo_menu}, {combo_line} , {combo_eqpid} , {selected_date} || ê²€ìƒ‰ ì‹œê°„ : {datetime.now()}")

            col1, col2, col3, col4, col5 = st.columns(5)

            with col1:
                if (combo_menu =='EBR') or (combo_menu =='EBR(WEE)'): data_combo_1 = st.selectbox('**EBR_SPEC(L)**', ['EBR', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='EBR_SPEC(L)')
                if combo_menu =='WEE': data_combo_1 = st.selectbox('**EBR_SPEC(L)**', ['EBR', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='WEE_SPEC(L)')
                if combo_menu =='TPR': data_combo_1 = st.selectbox('**MAIN_EQP_ID**', ['EBR', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='MAIN_EQP_ID')
                if combo_menu =='XPS': data_combo_1 = st.selectbox('**MAIN_EQP_MODEL**', ['LITHIUS', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='MAIN_EQP_MODEL')
            with col2:
                if (combo_menu =='EBR') or (combo_menu =='EBR(WEE)') :data_combo_2 = st.selectbox('**EBR_SPEC(H)**', ['EBR', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='EBR_SPEC(H)')
            with col3:
                if combo_menu =='EBR(WEE)' : data_combo_3 = st.selectbox('**WEE_SPEC(L)**', ['EBR', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='WEE SPEC(L)')
            with col4:
                if combo_menu =='EBR(WEE)' : data_combo_3 = st.selectbox('**WEE_SPEC(H)**', ['EBR', 'EBR(WEE)', 'WEE', 'TPR', 'XPS'], key='WEE SPEC(H)')

            edited_data = st.data_editor(
                st.session_state.filtered_data,
                column_config={
                    "ì •ë¦¬í•  DATA ì„ íƒ(1ê°œë§Œ)": st.column_config.CheckboxColumn(
                        "DATAëŠ” 1ê°œë§Œ ì„ íƒí•˜ì„¸ìš”",
                        help="ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”",
                        default=False,
                    ),
                    "SPEC ì„¤ì •": st.column_config.SelectboxColumn(  # ì½¤ë³´ë°•ìŠ¤ ì—´ì„ ì¶”ê°€
                        "SPEC ì„¤ì •",
                        options=["ì •ìƒ", "ì˜¤ë¥˜", "ì ê²€ ì¤‘"],  # ì½¤ë³´ë°•ìŠ¤ ì˜µì…˜
                        help="ìƒíƒœë¥¼ ì„ íƒí•˜ì„¸ìš”",
                    )
                },
                disabled=["EQP_ID", "ê³„ì¸¡ì™„ë£Œì‹œê°„"],  # EQP_ID ì—´ì€ ìˆ˜ì • ë¶ˆê°€
                hide_index=True,
            )    

            _, _, col1 = st.columns([3, 0.4, 0.5])  # ì²« ë²ˆì§¸ ì—´ì„ ë” í¬ê²Œ í•´ì„œ ë²„íŠ¼ì´ ì˜¤ë¥¸ìª½ì— ë°°ì¹˜ë˜ë„ë¡ ì„¤ì •

            with col1:
                search_button = st.form_submit_button("DATA ì •ë¦¬í•˜ê¸°")


    elif st.session_state.search_button == 1 and ("filtered_data" not in st.session_state or st.session_state.filtered_data.empty):
        st.markdown("**DATAê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**")
        st.markdown("**ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜, ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.**")

elif st.session_state.current_page == "ê¸°íƒ€ ì •ë³´":
    st.write("ê¸°íƒ€ ì •ë³´ í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.")
    st.write("ì´ê³³ì—ì„œ ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

